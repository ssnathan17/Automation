#!/bin/bash

# Variables
INPUT_FILE="unwanted_text.txt"        # File with content to compare
TARGET_DIR="/home/senthil/shell"  # Directory to search .txt files
EXCLUDE_FILE="exclude_text.txt"    # Exclusion list file
LOG_FILE="deletion_log.txt"   # Log of deleted lines

# Create or clear log file
> "$LOG_FILE"

# Function to check if a file or directory is in the exclusion list
is_excluded() {
    local item=$1
    grep -Fxq "$item" "$EXCLUDE_FILE"
}

# Read input file into an array
mapfile -t input_lines < "$INPUT_FILE"

# Find all .txt files in the target directory and its subdirectories
find "$TARGET_DIR" -type f -name "*.exc" | while read -r txt_file; do
    # Skip if file is in the exclusion list
    if is_excluded "$txt_file"; then
        echo "Skipping excluded file: $txt_file"
        continue
    fi
    
    # Create a temporary file to store updated content
    temp_file=$(mktemp)
    
    # Read the txt file line by line
    while IFS= read -r line; do
        # Check if the current line exists in the input file
        match_found=false
        for input_line in "${input_lines[@]}"; do
            if [[ "$line" == "$input_line" ]]; then
                match_found=true
                echo "Deleting line: $line from $txt_file" >> "$LOG_FILE"
                break
            fi
        done
        
        # If no match found, keep the line in the temporary file
        if [[ $match_found == false ]]; then
            echo "$line" >> "$temp_file"
        fi
    done < "$txt_file"
    
    # Replace the original file with the updated content
    mv "$temp_file" "$txt_file"
done

echo "Line deletion completed. Check $LOG_FILE for details."
